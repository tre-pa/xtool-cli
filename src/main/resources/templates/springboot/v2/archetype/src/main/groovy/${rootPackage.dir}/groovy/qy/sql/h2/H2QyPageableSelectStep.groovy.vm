package ${rootPackage.name}.groovy.qy.sql.h2


import org.springframework.data.domain.Page
import org.springframework.data.domain.PageImpl
import org.springframework.data.domain.Pageable
import org.springframework.jdbc.core.JdbcTemplate

import ${rootPackage.name}.groovy.qy.sql.QySqlPageableSelectStep

class H2QyPageableSelectStep implements QySqlPageableSelectStep {

	JdbcTemplate jdbcTemplate

	Map sqlFragments = [:]
	
	Pageable pageable;

	public H2QyPageableSelectStep(JdbcTemplate jdbcTemplate, Map sqlFragments, Pageable pageable) {
		super()
		this.jdbcTemplate = jdbcTemplate
		this.sqlFragments = sqlFragments
		this.pageable = pageable;
	}

	@Override
	public Page<List<Map<String, Object>>> fetchMaps() {
		def count = jdbcTemplate.queryForObject(sqlFragments['countSql'], Long.class);
		def result = jdbcTemplate.queryForList(sqlFragments['sql']);
		return new PageImpl(result, pageable, count);
	}
}
